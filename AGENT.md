## 1.从Bitcoin ETF USD Flow 网站爬取数据推送到supabase平台
### 1.1 目标网站
URL：https://farside.co.uk/bitcoin-etf-flow-all-data

### 1.2 目标数据
ETF Provider Configuration (Based on verified data from farside.co.uk)
ETF_PROVIDERS = {
    'IBIT': {
        'name': 'iShares Bitcoin Trust',
        'provider': 'BlackRock',
        'column_name': 'ibit_flow'
    },
    'FBTC': {
        'name': 'Fidelity Wise Origin Bitcoin Fund',
        'provider': 'Fidelity',
        'column_name': 'fbtc_flow'
    },
    'BITB': {
        'name': 'Bitwise Bitcoin ETF',
        'provider': 'Bitwise',
        'column_name': 'bitb_flow'
    },
    'ARKB': {
        'name': 'ARK 21Shares Bitcoin ETF',
        'provider': 'ARK Invest',
        'column_name': 'arkb_flow'
    },
    'BTCO': {
        'name': 'Invesco Galaxy Bitcoin ETF',
        'provider': 'Invesco',
        'column_name': 'btco_flow'
    },
    'EZBC': {
        'name': 'Franklin Bitcoin ETF',
        'provider': 'Franklin Templeton',
        'column_name': 'ezbc_flow'
    },
    'BRRR': {
        'name': 'Valkyrie Bitcoin Fund',
        'provider': 'Valkyrie',
        'column_name': 'brrr_flow'
    },
    'HODL': {
        'name': 'VanEck Bitcoin Trust',
        'provider': 'VanEck',
        'column_name': 'hodl_flow'
    },
    'BTCW': {
        'name': 'WisdomTree Bitcoin Fund',
        'provider': 'WisdomTree',
        'column_name': 'btcw_flow'
    },
    'GBTC': {
        'name': 'Grayscale Bitcoin Trust',
        'provider': 'Grayscale',
        'column_name': 'gbtc_flow'
    }
}
### 1.3 supabase平台表结构
create table public."Bitcoin_ETF_Flow_US$m" (
  date date not null,
  total_net_flow numeric null default 0,
  ibit_flow numeric null default 0,
  fbtc_flow numeric null default 0,
  bitb_flow numeric null default 0,
  arkb_flow numeric null default 0,
  btco_flow numeric null default 0,
  ezbc_flow numeric null default 0,
  brrr_flow numeric null default 0,
  hodl_flow numeric null default 0,
  btcw_flow numeric null default 0,
  gbtc_flow numeric null default 0,
  btc_flow numeric null default 0,
  created_at timestamp without time zone null default now(),
  updated_at timestamp without time zone null default now(),
  cumulated_total_flow numeric null,
  constraint Bitcoin_ETF_Flow_US$m_pkey primary key (date)
) TABLESPACE pg_default;

### 1.4 环境变量：
SUPABASE_URL 已配置到codex平台
SUPABASE_KEY 已配置到codex平台

## 2.从binance copy trade 网站爬取数据推送到supabase平台

### 2.1 目标网站
URL：https://www.binance.com/en/copy-trading/lead-details/4458914342020236800?timeRange=180D

### 2.2 目标数据和supabase平台表结构
create table public.binance_spot_copy_trade_overview (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  copiers integer null,
  "AUM_usdt" numeric null,
  "Leading_Balance_usdt" numeric null,
  lead_trader_id bigint null,
  scraped_date date null,
  mock_copiers smallint null,
  constraint binance_spot_copy_trade_overview_pkey primary key (id)
) TABLESPACE pg_default;

create table public.binance_spot_copy_trade (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  "ROI" numeric null,
  "PnL_usdt" numeric null,
  performance_days integer not null,
  "Copier_PnL_usdt" numeric null,
  "Sharpe_Ratio" numeric null,
  "MDD" text null,
  "Win_Rate" text null,
  "Win_Days" integer null,
  lead_trader_id bigint not null,
  scraped_date date not null,
  scraped_at timestamp with time zone null,
  constraint binance_spot_copy_trade_pkey primary key (id),
  constraint binance_spot_copy_trade_uid_scrapeddate_pdays_uk unique (lead_trader_id, scraped_date, performance_days)
) TABLESPACE pg_default;

create table public.binance_spot_copy_traders (
  duration bigint null,
  user_id text not null,
  amount numeric null,
  total_pnl numeric null,
  total_roi numeric null,
  created_date date not null,
  constraint binance_spot_copy_traders_pkey primary key (user_id, created_date)
) TABLESPACE pg_default;

## 3.部署方案

### 3.1 目的地服务器
阿里云函数计算
region: cn-hongkong
endpoint: https://1607116984302096.cn-hongkong.fc.aliyuncs.com

### 3.2 部署方式
阿里云serverless s CLI
环境变量：
ALIYUN_ACCESS_ID 已配置到codex平台
ALIYUN_SECRET_KEY 已配置到codex平台

## 4. 开发前环境配置
1. 安装serverless s CLI，配置default profile
2. codex平台已添加域名白名单：aliyuncs.com,binance.com,googleapis.com

## 5. 测试流程
用serverless s CLI 部署、触发、查看日志

